<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Journal</title>

  <style>
    :root{
      --bg:#ffffff;
      --fg:#111111;
      --muted:#5b5b5b;
      --line:#e7e7e7;
      --chip:#f4f4f4;
      --link:#0b57d0;
      --max:1120px;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
      color:var(--fg);
      background:var(--bg);
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      border-bottom:1px solid var(--line);
      position:sticky;
      top:0;
      background:#fff;
      z-index:10;
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 18px;}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .crumbs{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:var(--muted);
      font-size:13px;
    }
    .crumbs a{color:inherit}
    .brand{font-weight:800; color:#111;}
    .btn{
      border:1px solid var(--line);
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#fff; color:#111;}

    .hero{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      padding:18px 0 10px;
      border-bottom:1px solid var(--line);
    }
    @media (max-width: 860px){ .hero{grid-template-columns: 1fr;} }
    .cover{
      width:100%;
      aspect-ratio: 4/3;
      border:1px solid var(--line);
      border-radius:var(--radius);
      object-fit:cover;
      background:#f6f6f6;
    }
    h1{ margin:0 0 8px; font-size:30px; letter-spacing:-.3px; }
    .desc{ margin:0; color:var(--muted); line-height:1.6; font-size:14px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .pill{
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid var(--line);
      color:#333;
    }

    .content{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:18px;
      padding:18px 0 34px;
      align-items:start;
    }
    @media (max-width: 980px){ .content{grid-template-columns: 1fr;} }

    .panel{
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      background:#fff;
    }
    .panel h2{ margin:0 0 10px; font-size:16px; }
    .muted{ color:var(--muted); font-size:12.5px; line-height:1.6; }
    .search input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:14px;
      outline:none;
    }

    .articles{ display:flex; flex-direction:column; gap:12px; }
    .article{
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:12px 12px;
      background:#fff;
    }
    .article h3{ margin:0 0 6px; font-size:15px; line-height:1.3; }
    .article .meta{ margin:0; color:var(--muted); font-size:12.5px; line-height:1.5; }

    .hr{ height:1px; background:var(--line); margin:12px 0; }

    label{display:block; font-size:12px; color:#333; margin:10px 0 6px;}
    input, textarea{
      width:100%;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:14px;
      outline:none;
    }
    textarea{min-height:84px; resize:vertical}

    .danger{ color:#b00020; font-size:12.5px; line-height:1.45; margin-top:8px; white-space:pre-wrap; }
    .ok{ color:#0b7a2a; font-size:12.5px; line-height:1.45; margin-top:8px; white-space:pre-wrap; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
    }

    .members{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    .member{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      background:#fff;
    }
    .member .name{ font-weight:800; font-size:13.5px; margin:0 0 4px; }
    .member .role{ font-size:12px; color:#333; margin:0 0 4px; }
    .member .aff{ font-size:12px; color:var(--muted); margin:0; line-height:1.45; }
    .member a{ word-break:break-all; }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="crumbs">
        <a href="index.html" class="brand">Rubbish</a>
        <span>›</span>
        <span id="crumbJournal">Journal</span>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="btnZenodo" class="btn" type="button">Submit via Zenodo</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <img id="cover" class="cover" alt="Journal cover" />
    <div>
      <h1 id="title">Journal</h1>
      <p class="desc" id="journalIntro">
        This journal publishes rigorously documented boundary findings, including well-executed negative results,
        informative failed experiments, and reproducible anomalies that merit careful record and discussion.
      </p>
      <div class="row">
        <span class="pill" id="pillFolder">folder</span>
        <span class="pill">Open access</span>
        <span class="pill">Method-first</span>
      </div>
    </div>
  </section>

  <section class="content">
    <div>
      <div class="panel">
        <h2>Aims & Scope</h2>
        <p class="muted">
          The Rubbish series provides a structured venue for results that are frequently underrepresented despite high scientific value:
          (i) negative results and null findings obtained under well-controlled conditions; (ii) failed experiments whose protocols,
          constraints, and troubleshooting paths carry transferable methodological insight; (iii) reproducible anomalous observations
          that are statistically credible yet difficult to reconcile with prevailing models; and (iv) short laboratory reports describing
          unusual, surprising, or “mind-shifting” phenomena observed during routine research, provided the reporting remains transparent,
          method-anchored, and non-speculative.
        </p>

        <div class="hr"></div>

        <h2>Articles</h2>
        <div class="search" style="margin:10px 0 12px;">
          <input id="search" type="search" placeholder="Search by title, authors, DOI" autocomplete="off" />
        </div>
        <div id="articles" class="articles" aria-live="polite"></div>
        <p id="articlesStatus" class="muted" style="margin-top:10px;">Loading…</p>
      </div>
    </div>

    <aside>
      <div class="panel">
        <h2>Submission</h2>
        <p class="muted">
          Upload your PDF to Zenodo to obtain a DOI, then return here and register the metadata.
          Registration is performed by submitting a GitHub Issue (no GitHub token required). A workflow will validate the required fields
          and append the record to <b>article.txt</b> in this journal folder.
        </p>

        <div class="hr"></div>

        <label>Title (required)</label>
        <textarea id="fTitle" placeholder="Article title"></textarea>

        <label>Authors (required)</label>
        <textarea id="fAuthors" placeholder="Author list (e.g., A. Smith; B. Lee)"></textarea>

        <label>Affiliations (required)</label>
        <textarea id="fAff" placeholder="Institution(s)"></textarea>

        <label>ORCID (required)</label>
        <input id="fOrcid" type="text" placeholder="e.g., 0000-0002-1825-0097" />

        <label>DOI (required)</label>
        <input id="fDoi" type="text" placeholder="e.g., 10.5281/zenodo.1234567" />

        <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
          <button id="btnIssue" class="btn" type="button">Open Issue Draft</button>
          <button id="btnRefresh" class="btn secondary" type="button">Refresh list</button>
        </div>

        <p id="msg" class="muted" style="margin-top:10px;"></p>

        <div class="hr"></div>
        <p class="muted">Required issue-body format (auto-generated):</p>
        <pre class="mono" style="margin:8px 0 0; background:#fafafa; border:1px solid var(--line); padding:10px; border-radius:12px; overflow:auto;">JOURNAL_FOLDER: &lt;folder&gt;
TITLE: &lt;title&gt;
AUTHORS: &lt;authors&gt;
AFFILIATIONS: &lt;affiliations&gt;
ORCID: &lt;orcid&gt;
DOI: &lt;doi&gt;</pre>
      </div>

      <div class="panel" style="margin-top:18px;">
        <h2>Editorial Board</h2>
        <p class="muted" id="membersHint">Loading members…</p>
        <div id="members" class="members"></div>
      </div>
    </aside>
  </section>
</main>

<script>
(() => {
  const OWNER = "shangguansuyan";
  const REPO  = "rubbish";
  const BRANCH = "main";

  const qs = new URLSearchParams(location.search);
  const folder = qs.get("j") || "";

  const elTitle = document.getElementById("title");
  const elCrumb = document.getElementById("crumbJournal");
  const elPill  = document.getElementById("pillFolder");
  const elCover = document.getElementById("cover");

  const elArticles = document.getElementById("articles");
  const elArticlesStatus = document.getElementById("articlesStatus");
  const elSearch = document.getElementById("search");

  const elMsg = document.getElementById("msg");

  const elFTitle = document.getElementById("fTitle");
  const elFAuthors = document.getElementById("fAuthors");
  const elFAff = document.getElementById("fAff");
  const elFOrcid = document.getElementById("fOrcid");
  const elFDoi = document.getElementById("fDoi");

  const btnZenodo = document.getElementById("btnZenodo");
  const btnIssue = document.getElementById("btnIssue");
  const btnRefresh = document.getElementById("btnRefresh");

  const elMembers = document.getElementById("members");
  const elMembersHint = document.getElementById("membersHint");

  if(!folder){
    elTitle.textContent = "Journal not specified";
    elCrumb.textContent = "Journal";
    elPill.textContent = "missing folder";
    elArticlesStatus.textContent = "Missing ?j=<folder> in URL.";
    btnZenodo.disabled = true;
    btnIssue.disabled = true;
    btnRefresh.disabled = true;
    return;
  }

  function esc(s){
    return String(s).replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    })[c]);
  }

  function setMsg(kind, text){
    elMsg.className = kind === "ok" ? "ok" : (kind === "danger" ? "danger" : "muted");
    elMsg.textContent = text;
  }

  function normalizeDoi(input){
    const s = (input || "").trim();
    if(!s) return "";
    if(/^10\./.test(s)) return s.replace(/[)\],.]+$/,"");
    const m = s.match(/10\.\d{4,9}\/\S+/);
    return m ? m[0].replace(/[)\],.]+$/,"") : s;
  }

  function doiLink(doi){
    const d = normalizeDoi(doi);
    return `https://doi.org/${encodeURIComponent(d)}`;
  }

  async function fetchJSON(url){
    const res = await fetch(url, { headers: { "Accept":"application/vnd.github+json" }});
    if(!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
    return await res.json();
  }

  const apiRoot = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;
  const isImage = (name) => /\.(png|jpe?g|webp|gif)$/i.test(name);

  async function listFolder(){
    return await fetchJSON(`${apiRoot}/${encodeURIComponent(folder)}?ref=${encodeURIComponent(BRANCH)}`);
  }

  async function readNameTxt(){
    const item = await fetchJSON(`${apiRoot}/${encodeURIComponent(folder)}/name.txt?ref=${encodeURIComponent(BRANCH)}`);
    if(item && item.content){
      return atob(item.content.replace(/\n/g,"")).trim() || folder;
    }
    return folder;
  }

  async function pickCover(){
    try{
      const items = await listFolder();
      const images = items
        .filter(x => x.type === "file" && isImage(x.name))
        .sort((a,b)=>a.name.localeCompare(b.name));
      if(images.length > 0) return images[0].download_url;
    } catch {}
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
      <rect width='100%' height='100%' fill='#f2f2f2'/>
      <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
            font-family='Arial' font-size='22' fill='#777'>No cover image</text>
    </svg>`;
    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
  }

  function parseJSONL(text){
    const lines = text.split(/\r?\n/).map(x => x.trim()).filter(Boolean);
    const out = [];
    for(const ln of lines){
      try{ out.push(JSON.parse(ln)); } catch {}
    }
    out.sort((a,b)=> (b.ts||0) - (a.ts||0));
    return out;
  }

  function renderArticles(list){
    const term = (elSearch.value || "").trim().toLowerCase();
    const filtered = !term ? list : list.filter(a =>
      String(a.title||"").toLowerCase().includes(term) ||
      String(a.authors||"").toLowerCase().includes(term) ||
      String(a.affiliations||"").toLowerCase().includes(term) ||
      String(a.orcid||"").toLowerCase().includes(term) ||
      String(a.doi||"").toLowerCase().includes(term)
    );

    elArticles.innerHTML = filtered.map(a => {
      const title = esc(a.title || "Untitled");
      const authors = esc(a.authors || "");
      const aff = esc(a.affiliations || "");
      const orcid = esc(a.orcid || "");
      const doi = esc(a.doi || "");
      const link = doi ? doiLink(doi) : "";
      return `
        <div class="article">
          <h3>${title}</h3>
          <p class="meta"><b>Authors:</b> ${authors || "—"}</p>
          <p class="meta"><b>Affiliations:</b> ${aff || "—"}</p>
          <p class="meta"><b>ORCID:</b> ${orcid || "—"}</p>
          <p class="meta"><b>DOI:</b> ${doi ? `<a href="${esc(link)}" target="_blank" rel="noopener">${doi}</a>` : "—"}</p>
        </div>
      `;
    }).join("");

    elArticlesStatus.textContent = `${filtered.length} article(s) shown`;
  }

  async function loadArticles(){
    elArticlesStatus.textContent = "Loading…";
    elArticles.innerHTML = "";

    const raw = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${encodeURIComponent(folder)}/article.txt?t=${Date.now()}`;

    try{
      const res = await fetch(raw, { cache: "no-store" });
      if(res.status === 404){
        elArticlesStatus.textContent = "No indexed articles yet.";
        renderArticles([]);
        return [];
      }
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      const list = parseJSONL(text);
      renderArticles(list);
      return list;
    } catch (e){
      console.error(e);
      elArticlesStatus.textContent = "Failed to load article index.";
      return [];
    }
  }

  function renderMembers(list){
    elMembers.innerHTML = list.map(m => {
      const name = esc(m.name || "—");
      const role = esc(m.role || "Editorial Board");
      const interests = esc(m.interests || "");
      const affArr = Array.isArray(m.affiliations) ? m.affiliations : (m.affiliation ? [m.affiliation] : []);
      const aff = esc(affArr.filter(Boolean).join("; "));
      const orcid = (m.orcid || "").trim();
      const orcidUrl = orcid ? `https://orcid.org/${encodeURIComponent(orcid)}` : "";

      return `
        <div class="member">
          <p class="name">${name}</p>
          <p class="role">${role}</p>
          <p class="aff"><b>Affiliations:</b> ${aff || "—"}</p>
          ${interests ? `<p class="aff"><b>Interests:</b> ${interests}</p>` : ``}
          ${orcid ? `<p class="aff"><b>ORCID:</b> <a href="${esc(orcidUrl)}" target="_blank" rel="noopener">${esc(orcid)}</a></p>` : ``}
        </div>
      `;
    }).join("");
  }

  async function loadMembers(){
    const raw = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/members.json?t=${Date.now()}`;
    try{
      const res = await fetch(raw, { cache: "no-store" });
      if(res.status === 404){
        elMembersHint.textContent = "Editorial board list not available.";
        elMembers.innerHTML = "";
        return;
      }
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      if(!Array.isArray(data) || data.length === 0){
        elMembersHint.textContent = "No editorial board members listed.";
        elMembers.innerHTML = "";
        return;
      }

      // Optional: stable sort by role then name
      const order = ["Editor in Chief","Co-Editor in Chief","Managing Editor","Associate Editor","Editorial Board"];
      data.sort((a,b) => {
        const ra = order.indexOf(a.role || "");
        const rb = order.indexOf(b.role || "");
        const pa = ra === -1 ? 999 : ra;
        const pb = rb === -1 ? 999 : rb;
        if(pa !== pb) return pa - pb;
        return String(a.name||"").localeCompare(String(b.name||""));
      });

      elMembersHint.textContent = `${data.length} member(s)`;
      renderMembers(data);
    } catch (e){
      console.error(e);
      elMembersHint.textContent = "Failed to load members.";
      elMembers.innerHTML = "";
    }
  }

  // Actions
  btnZenodo.addEventListener("click", () => {
    const zenodoLogin = "https://zenodo.org/login";
    window.open(zenodoLogin, "_blank", "noopener");
    setMsg("muted",
      "Zenodo opened in a new tab. After uploading your PDF and obtaining a DOI, paste it into the DOI field and open the Issue draft."
    );
  });

  btnRefresh.addEventListener("click", () => loadArticles());

  elSearch.addEventListener("input", async () => {
    await loadArticles();
  });

  btnIssue.addEventListener("click", () => {
    const title = (elFTitle.value || "").trim();
    const authors = (elFAuthors.value || "").trim();
    const affiliations = (elFAff.value || "").trim();
    const orcid = (elFOrcid.value || "").trim();
    const doiRaw = (elFDoi.value || "").trim();
    const doi = normalizeDoi(doiRaw);

    if(!title || !authors || !affiliations || !orcid || !doi){
      setMsg("danger", "All fields are required: Title, Authors, Affiliations, ORCID, DOI.");
      return;
    }

    const issueTitle = (`[ARTICLE] ${title}`).slice(0, 180);

    const body =
`JOURNAL_FOLDER: ${folder}
TITLE: ${title}
AUTHORS: ${authors}
AFFILIATIONS: ${affiliations}
ORCID: ${orcid}
DOI: ${doi}

(Submitted from journal page)`;

    const url = new URL(`https://github.com/${OWNER}/${REPO}/issues/new`);
    url.searchParams.set("title", issueTitle);
    url.searchParams.set("body", body);

    window.open(url.toString(), "_blank", "noopener");
    setMsg("ok",
      "An Issue draft has been opened in a new tab.\n" +
      "Submit it. The index will update automatically after the workflow completes.\n" +
      "If the article does not appear immediately, click “Refresh list”."
    );
  });

  async function init(){
    elPill.textContent = folder;

    // Validate journal definition (must contain name.txt)
    try{
      const items = await listFolder();
      const ok = items.some(x => x.type === "file" && x.name === "name.txt");
      if(!ok){
        elTitle.textContent = "Invalid journal folder";
        elCrumb.textContent = "Journal";
        setMsg("danger", "This folder does not contain name.txt and is not recognized as a journal.");
        btnZenodo.disabled = true;
        btnIssue.disabled = true;
        btnRefresh.disabled = true;
        elArticlesStatus.textContent = "No data.";
        elMembersHint.textContent = "No data.";
        return;
      }
    } catch {}

    const [name, cover] = await Promise.all([readNameTxt(), pickCover()]);
    document.title = `${name} | Rubbish`;
    elTitle.textContent = name;
    elCrumb.textContent = name;
    elCover.src = cover;
    elCover.alt = `${name} cover`;

    await Promise.all([loadArticles(), loadMembers()]);
  }

  init().catch(err => {
    console.error(err);
    setMsg("danger", "Failed to initialize journal page. Check folder name and repository access.");
  });
})();
</script>
</body>
</html>
